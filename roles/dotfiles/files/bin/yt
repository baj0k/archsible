#!/bin/sh

task=$(printf "stream\ndownload" | dmenu -i -p "Youtube:")

case "${task}" in
    stream) 
        src=$(dmenu -i -p "Stream:" <&-)
        [ -n "${src}" ] && mpv --ytdl-format='bestvideo[height<=?1080][vcodec!=vp9]+bestaudio/best' ytdl://ytsearch:"${src}" ;;

    download)
        mode=$(printf "audio\nvideo" | dmenu -i -p "Download:")
        src=$(dmenu -i -p "Download:" <&-) ;;
    *) exit 0 ;;
esac

[ -n "${mode}" ] && case "${mode}" in
    audio) yt-dlp -o "${HOME}/music/%(artist)s-%(title)s.%(ext)s" --restrict-filenames -xic -f bestaudio/best --hls-prefer-ffmpeg ;;
    video) yt-dlp -o "${HOME}/video/%(title)s.%(ext)s" --restrict-filenames -ic -f best --hls-prefer-ffmpeg ;;
    *) exit 0 ;;
esac
