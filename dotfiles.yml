# TODO: prevent data loss - ensure that here are aliases set for rm, mv and cp with the "-i" flag that requires confirmation before executing command
# TODO: Read through Archwiki general recommendations page for additional configuration
# TODO: checkout coreutils improvements / alternatives from archwiki - saerch for wechiwiki core utilities
# TODO: checkout base9 from suckless and explore possibilities of using it along / instead of coreustils GNU
# TODO: add git config and move sensitive data to another file
---
- hosts: workstations
  remote_user: test

  vars:
    # Path for the repository and dotfiles
    repo_path: "{{ ansible_env.HOME }}/repos"
    dotfiles_path: "{{ repo_path }}/archsible/roles/dotfiles/files"

    # Copy environment from the ansible controller
    migrate: false

    # Include software tasks
    docker: true
    dunst: true
    firefox: true # TODO: add symlinks for user.js 
    i3: true
    mpd: true
    mpv: true
    ncmpcpp: true
    neofetch: true
    newsboat: true
    neovim: true
    ranger: true
    suckless: true
    tmux: true
    zathura: true
    zsh: true

  pre_tasks:
    - name: Check internet connection
      command: ping -c 1 -w 1 google.com
      changed_when: False

  roles:
    - dotfiles
  
  post_tasks:
     - name: Disable sshd.service
       become: yes
       systemd:
         name: sshd
         enabled: no

     - name: Reboot after installation is complete
       become: yes
       shell: sleep 2 && reboot
       async: 5
       poll: 0
     - meta: end_host
